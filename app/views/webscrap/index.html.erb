<div class="container-fluid mt-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="mb-0">Web Scraping Jobs</h2>
            <div>
              <%= link_to new_webscrap_path, class: 'btn btn-success btn-lg' do %>
                <i class="fas fa-plus"></i> New Scraping Job
              <% end %>
              <span class="badge bg-primary ms-2">Total Jobs: <%= @scraping_jobs.count %></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty state for no jobs -->
  <% if @scraping_jobs.empty? %>
    <div class="row">
      <div class="col-12 text-center py-5">
        <div class="empty-state">
          <i class="fas fa-spider fa-4x text-muted mb-3"></i>
          <h3>No Scraping Jobs Yet</h3>
          <p class="text-muted">Start by creating your first scraping job!</p>
          <%= link_to new_webscrap_path, class: 'btn btn-primary btn-lg mt-3' do %>
            <i class="fas fa-plus"></i> Create First Job
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <!-- Existing jobs table -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Base URL</th>
                    <th>Status</th>
                    <th>Pages Scraped</th>
                    <th>Target Depth</th>
                    <th>Actual Depth</th>
                    <th>Started At</th>
                    <th>Duration</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @scraping_jobs.each do |job| %>
                    <tr>
                      <td><%= job.id %></td>
                      <td class="text-truncate" style="max-width: 200px;">
                        <%= link_to job.base_url, job.base_url, target: '_blank', title: job.base_url %>
                      </td>
                      <td>
                        <% status_class = case job.status
                           when 'completed' then 'bg-success'
                           when 'in_progress' then 'bg-warning'
                           when 'failed' then 'bg-danger'
                           end %>
                        <span class="badge <%= status_class %>">
                          <%= job.status.titleize %>
                        </span>
                        <% if job.status == 'failed' && job.error_message.present? %>
                          <i class="fas fa-info-circle text-danger" 
                             data-bs-toggle="tooltip" 
                             title="<%= job.error_message %>"></i>
                        <% end %>
                      </td>
                      <td><%= job.scraped_pages.count %></td>
                      <td><%= job.nest_depth %></td>
                      <td>
                        <% if job.actual_depth.present? %>
                          <%= job.actual_depth %>
                          <% if job.actual_depth < job.nest_depth %>
                            <i class="fas fa-info-circle text-info" 
                               data-bs-toggle="tooltip" 
                               title="Site structure had fewer levels than target depth"></i>
                          <% end %>
                        <% else %>
                          -
                        <% end %>
                      </td>
                      <td><%= job.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
                      <td>
                        <% if job.completed_at %>
                          <%= ((job.completed_at - job.created_at)/60).round %> min
                        <% else %>
                          -
                        <% end %>
                      </td>
                      <td>
                        <%= link_to show_scraping_job_webscrap_index_path(id: job.id), 
                            class: 'btn btn-sm btn-primary',
                            title: 'View Results' do %>
                          <i class="fas fa-eye"></i>
                        <% end %>
                        
                        <% if job.status == 'in_progress' %>
                          <%= link_to process_scraping_webscrap_path(job), 
                              class: 'btn btn-sm btn-info',
                              title: 'View Progress' do %>
                            <i class="fas fa-spinner"></i>
                          <% end %>
                        <% end %>

                        <%= button_to webscrap_path(job), 
                            method: :delete,
                            class: 'btn btn-sm btn-danger',
                            form: { style: 'display: inline-block' },
                            data: { 
                              turbo_confirm: 'Are you sure? This will delete all scraped data for this job.',
                              turbo_method: :delete 
                            },
                            title: 'Delete Job' do %>
                          <i class="fas fa-trash"></i>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })
});
</script>

<style>
.card {
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.badge {
  font-size: 0.9rem;
  padding: 8px 12px;
}

.table-hover tbody tr:hover {
  background-color: #f8f9fa;
}

.btn-sm {
  padding: 0.25rem 0.5rem;
  margin: 0 2px;
}

.empty-state {
  padding: 40px;
  background-color: #f8f9fa;
  border-radius: 8px;
}

.text-truncate {
  max-width: 200px;
  display: inline-block;
  vertical-align: middle;
}
</style> 